# Управление SSH-ключами через Vault с использованием Ansible и Makefile

## Описание

Проект предназначен для автоматического управления SSH-ключами на серверах с использованием `Ansible` и `Vault`. `Makefile` упрощает развертывание и автоматизацию задач.

## Структура файлов

- `Makefile` — содержит команды для развёртывания ключей, настройки окружения и крон-задачи.
- `inventory.yaml` — инвентори-файл Ansible, содержащий список серверов.
- `upload_authorized_keys.yaml` — Ansible-плейбук для получения ключей из HashiCorp Vault и их развёртывания.
- `deploy.log` — файл логов выполнения заданий.

## Использование

### 1. Создание виртуального окружения и установка зависимостей

```sh
make create_env
```

Это создаст виртуальное окружение и установит необходимые пакеты (`ansible` и `hvac`).

### 2. Деплой SSH-ключей

```sh
make deploy
```

Эта команда выполнит плейбук `upload_authorized_keys.yaml`, получит SSH-ключи из `Vault` и развернёт их на серверах.

### 3. Настройка автоматического обновления ключей через `cron`

```sh
make setup_cron
```

Добавляет в `cron` задание, которое каждые 10 минут выполняет `make deploy`. Логи записываются в `/tmp/deploy.log`.

## Дополнительные команды

### Проверка работы `cron`

Можно вручную запустить команду из `cron`:

```sh
cd /home/vasya/ssh && source /opt/ansible_venv/bin/activate && make deploy
```

### Обновление зависимостей

Если требуется обновить `ansible` и `hvac`:

```sh
source /opt/ansible_venv/bin/activate && pip install --upgrade ansible hvac
```



